import { getSelfHealingPage } from "playwright-selfheal-ai";
import { logger } from "../utils/logger.js";
/**
 * Returns a working **selector string**, not a Locator.
 * Tries multiple locators manually; falls back to AI self-healing if all fail.
 */
export async function findElementUniversal(page, locators, elementName = "unknown element", timeout = 5000) {
    // Try each locator manually
    for (const locator of locators) {
        try {
            const element = page.locator(locator);
            await element.waitFor({ state: "attached", timeout });
            logger.info(`Found valid element for "${elementName}" with locator: ${locator}`);
            return locator; // return selector string
        }
        catch {
            logger.warn(`Failed locator for "${elementName}": ${locator}`);
        }
    }
    // If all fail → use AI self-healing
    try {
        logger.info(`Attempting AI healing for "${elementName}"...`);
        const healingPage = await getSelfHealingPage(page);
        const baseLocator = locators[0];
        const aiLocator = healingPage.locator(baseLocator);
        await aiLocator.waitFor({ state: "attached", timeout });
        logger.info(`AI self-healed locator for "${elementName}" successfully.`);
        return baseLocator; // still return usable selector string
    }
    catch (error) {
        logger.error(`AI self-heal failed for "${elementName}": ${error.message}`);
    }
    // If nothing works → throw
    logger.error(`No valid locator found for "${elementName}".`);
    throw new Error(`Element not found: ${elementName}`);
}
